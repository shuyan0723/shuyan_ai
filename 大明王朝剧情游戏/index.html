<!DOCTYPE html>
<html lang="zh">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>锦衣卫夜行录 - 悬疑烧脑剧情游戏</title>
  <link rel="stylesheet" href="css/style.css">
</head>

<body>
  <!-- 开场介绍遮罩 -->
  <div id="intro-overlay"
    style="position:fixed;z-index:9999;top:0;left:0;width:100vw;height:100vh;background:radial-gradient(ellipse at 60% 40%,rgba(80,0,0,0.95) 0%,rgba(20,0,0,0.98) 80%),linear-gradient(135deg,#1a1a1a 0%,#3a0a0a 100%);color:#fff;display:flex;flex-direction:column;align-items:center;justify-content:center;font-size:1.3rem;transition:opacity 0.8s;box-shadow:0 0 80px 20px #2a0000 inset;">
    <div id="intro-bg" style="max-width:600px;text-align:center;opacity:1;position:relative;">
      <div
        style="position:absolute;left:0;top:-60px;width:100%;display:flex;justify-content:center;pointer-events:none;">
        <span
          style="font-size:3.5rem;color:#b71c1c;text-shadow:0 0 18px #ff4444,0 0 8px #000;animation:pulse-blood 2.5s infinite alternate;">&#9760;</span>
      </div>
      <h2 style="font-size:2.2rem;margin-bottom:1.5em;letter-spacing:2px;text-shadow:0 0 12px #b71c1c,0 0 2px #000;">
        嘉靖四十五年 · 皇宫悬案</h2>
      <div id="intro-step1">
        <p style="text-shadow:0 0 8px #b71c1c,0 0 2px #000;">
          大明王朝风雨飘摇，嘉靖皇帝突然暴毙，朝堂暗流涌动。东厂、锦衣卫、内阁、皇族、方士、武将，各方势力明争暗斗，真相被层层迷雾笼罩。</p>
      </div>
      <div id="intro-step2" style="display:none;">
        <p style="text-shadow:0 0 8px #b71c1c,0 0 2px #000;">你是一名锦衣卫百户，奉命彻查皇帝死因。你必须在权谋与杀机中周旋，收集线索，平衡各方势力，揭开宫廷悬案的真相。</p>
      </div>
      <button id="intro-next-btn"
        style="margin-top:2em;padding:0.7em 2.5em;font-size:1.2rem;background:linear-gradient(90deg,#6b0f1a 60%,#b71c1c 100%);color:#fff;border:none;border-radius:6px;cursor:pointer;box-shadow:0 0 12px #b71c1c;transition:background 0.3s;">继续</button>
      <button id="enter-game-btn"
        style="margin-top:2em;padding:0.7em 2.5em;font-size:1.2rem;background:linear-gradient(90deg,#b71c1c 60%,#6b0f1a 100%);color:#fff;border:none;border-radius:6px;cursor:pointer;display:none;box-shadow:0 0 12px #b71c1c;transition:background 0.3s;">进入游戏</button>
      <style>
        @keyframes pulse-blood {
          0% {
            filter: drop-shadow(0 0 0 #b71c1c);
          }

          100% {
            filter: drop-shadow(0 0 18px #ff4444);
          }
        }

        @keyframes float-skull {
          0% {
            transform: translateY(0);
          }

          50% {
            transform: translateY(-18px);
          }

          100% {
            transform: translateY(0);
          }
        }

        @keyframes fadein {
          from {
            opacity: 0;
          }

          to {
            opacity: 1;
          }
        }

        #intro-overlay::after {
          content: '';
          position: absolute;
          left: 0;
          top: 0;
          width: 100vw;
          height: 100vh;
          pointer-events: none;
          background: repeating-linear-gradient(120deg, rgba(183, 28, 28, 0.08) 0 2px, transparent 2px 40px);
        }

        #intro-bg {
          animation: fadein 1.2s;
        }

        #intro-bg h2,
        #intro-bg p {
          animation: fadein 1.5s;
        }

        #intro-bg span {
          animation: pulse-blood 2.5s infinite alternate, float-skull 4s infinite ease-in-out;
        }

        #intro-next-btn,
        #enter-game-btn {
          transition: background 0.3s, box-shadow 0.3s, transform 0.2s;
        }

        #intro-next-btn:hover,
        #enter-game-btn:hover {
          background: linear-gradient(90deg, #b71c1c 60%, #6b0f1a 100%);
          box-shadow: 0 0 24px #ff4444, 0 0 8px #b71c1c;
          transform: scale(1.06);
        }
      </style>
    </div>
  </div>

  <div class="game-container" id="main-game" style="display:none;">
    <div class="game-header">
      <h1>锦衣卫夜行录</h1>
      <p class="subtitle">嘉靖四十五年 · 皇宫悬案</p>
      <button id="sound-btn" class="sound-btn"
        style="position:fixed;top:50%;right:32px;transform:translateY(-50%);z-index:2000;">🔊</button>
    </div>

    <div class="game-layout">
      <!-- 中央游戏内容 -->
      <div class="game-content">
        <div id="story-text" class="story-text">
          <!-- 故事内容将通过JavaScript动态添加 -->
        </div>

        <div id="choices" class="choices">
          <!-- 选项将通过JavaScript动态添加 -->
        </div>

        <div class="game-controls">
          <button id="restart-btn" class="control-btn" onclick="restartGameFromIntro()">重新开始</button>
          <button id="save-btn" class="control-btn">
            保存游戏
          </button>
          <button id="load-btn" class="control-btn">
            加载游戏
          </button>
        </div>
      </div>
    </div>
  </div>

  <script src="js/game.js"></script>
  <script>
    // 开场介绍分步显示与进入游戏
    const introNextBtn = document.getElementById('intro-next-btn');
    const enterGameBtn = document.getElementById('enter-game-btn');
    const introStep1 = document.getElementById('intro-step1');
    const introStep2 = document.getElementById('intro-step2');
    const introOverlay = document.getElementById('intro-overlay');
    const mainGame = document.getElementById('main-game');
    let introStep = 1;
    // 自动播放背景音乐和音效
    function playIntroBGM() {
      try {
        if (window.gameEngine && window.gameEngine.audioManager && window.gameEngine.audioManager.bgm) {
          window.gameEngine.audioManager.bgm.play().catch(() => { });
        }
        // 可选：播放一声低沉的钟声或脚步声
        if (window.gameEngine && window.gameEngine.audioManager) {
          window.gameEngine.audioManager.playSound('click');
        }
      } catch (e) { }
    }
    window.addEventListener('DOMContentLoaded', playIntroBGM);
    introNextBtn.onclick = function () {
      if (introStep === 1) {
        introStep1.style.display = 'none';
        introStep2.style.display = 'block';
        introStep = 2;
      } else if (introStep === 2) {
        introNextBtn.style.display = 'none';
        enterGameBtn.style.display = 'inline-block';
      }
    };
    enterGameBtn.onclick = function () {
      introOverlay.style.opacity = 0;
      setTimeout(() => {
        introOverlay.style.display = 'none';
        mainGame.style.display = '';
      }, 800);
    };
    function restartGameFromIntro() {
      // 关闭intro-overlay，显示主游戏
      document.getElementById('intro-overlay').style.opacity = 0;
      setTimeout(() => {
        document.getElementById('intro-overlay').style.display = 'none';
        document.getElementById('main-game').style.display = '';
        if (window.gameEngine && window.gameEngine.state && window.gameEngine.sceneManager) {
          window.gameEngine.state.reset();
          window.gameEngine.sceneManager.showScene('prologue');
          window.gameEngine.updateUI && window.gameEngine.updateUI();
        }
      }, 800);
    }
  </script>
  <script>
    // 初始化游戏引擎
    window.addEventListener('DOMContentLoaded', () => {
      const gameEngine = new GameEngine();
      gameEngine.init();
    });
  </script>
</body>

</html>